version: "prometheus/v1"
service: "java-demo-app"
labels:
  component: "kubernetes"
slos:
  - name: "requests-availability"
    objective: 99.9
    description: "JAVA APP Availability"
    labels:
      category: availability
    sli:
      events:
        error_query: sum(rate(istio_requests_totall{code=~"(5..|429)"}[{{.window}}]))
        total_query: sum(rate(istio_requests_totall[{{.window}}]))
    alerting:
      name: java-demoAvailabilityAlert
      labels:
        category: "availability"
      page_alert:
        labels:
          severity: critical
      ticket_alert:
        labels:
          severity: warning

  - name: "requests-latency"
    objective: 99
    description: "JAVA APP Latency"
    labels:
      category: latency
    sli:
      events:
        error_query: |
          (
            sum(rate(istio_request_duration_milliseconds_count{verb!="WATCH"}[{{.window}}]))
            -
            sum(rate(istio_request_duration_milliseconds_bucket{le="0.4",verb!="WATCH"}[{{.window}}]))
          )
        total_query: sum(rate(istio_request_duration_milliseconds_count{verb!="WATCH"}[{{.window}}]))
    alerting:
      name: java-demoLatencyAlert
      labels:
        category: "latency"
      page_alert:
        labels:
          severity: critical
      ticket_alert:
        labels:
          severity: warning
